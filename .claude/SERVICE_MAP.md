# Service Map - Park Golf Platform

## 🗺️ 서비스 의존성 매핑

### 서비스 계층 구조
```
┌─────────────────────────────────────────────────────────────┐
│                     Frontend Layer                          │
├─────────────────────────────────────────────────────────────┤
│  admin-dashboard:3000    │    user-webapp:3001             │
│  (React + Redux) ✅      │    (React) ⚠️                   │
└─────────────────────────┴─────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                      BFF Layer                              │
├─────────────────────────────────────────────────────────────┤
│    admin-api:3091       │      user-api:3092               │
│    (NestJS) ✅          │      (NestJS) ⚠️                │
└─────────────────────────┴─────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                  Microservices Layer                        │
├─────────────────────────────────────────────────────────────┤
│ auth-service:3011  │ course-service:NATS  │ booking:3013   │
│ (JWT) ✅          │ (코스관리) ✅         │ (예약) ✅      │
├─────────────────────────────────────────────────────────────┤
│ notify-service:3014│ search-service:3015  │ ml-service:4000│
│ (알림) ✅          │ (검색) ❌            │ (ML) ⚠️        │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                 Infrastructure Layer                        │
├─────────────────────────────────────────────────────────────┤
│ PostgreSQL:5432 │ Redis:6379 │ NATS:4222 │ Elasticsearch   │
│ (다중 DB) ✅    │ (캐시) ✅  │ (메시징) ✅│ :9200 ✅       │
└─────────────────────────────────────────────────────────────┘
```

### 서비스 간 통신 패턴

#### 1. HTTP 통신 (동기)
```
Frontend → BFF → Microservices
```

#### 2. NATS 통신 (비동기)
```
auth-service → notify-service  (사용자 가입/로그인 알림)
booking-service → notify-service  (예약 확인 알림)
course-service → search-service  (코스 정보 인덱싱)
booking-service → ml-service  (예약 패턴 분석)
```

### 데이터베이스 구조
```
PostgreSQL:5432
├── parkgolf (공통 DB)
├── auth_db (인증 전용)
├── course_db (코스 정보)
├── booking_db (예약 데이터)
├── notify_db (알림 로그)
└── ml_db (ML 학습 데이터)
```

### 서비스별 핵심 역할

#### **auth-service:3011** ✅
- JWT 토큰 발급/검증
- 사용자 인증/인가
- RBAC 권한 관리 (40+ 권한)
- 관리자/사용자 계정 관리

#### **course-service (NATS only)** ✅
- 골프장 정보 관리
- 코스 및 홀 데이터
- 타임슬롯 관리 (완전 구현)
- 시설 정보 관리

#### **booking-service:3013** ✅
- 예약 생성/취소/변경 (완료)
- 9홀/18홀 복잡한 예약 로직
- 타임슬롯 가용성 캐싱
- NATS 이벤트 발행 구현 완료

#### **notify-service:3014** ✅
- 이메일/SMS 발송
- 알림 템플릿 관리
- 알림 히스토리 관리
- 다중 채널 지원

#### **search-service:3015** ❌
- DB 스키마만 존재
- 모든 비즈니스 로직 미구현
- 기본 NestJS 구조만 존재
- **미완료**: 전체 구현 필요

#### **ml-service:4000** ⚠️
- Express.js + MongoDB 인프라
- 기본 API 엔드포인트만 존재
- ML 모델 미구현
- **주의**: 다른 데이터베이스 스택 사용

### BFF 서비스 역할

#### **admin-api:3091** ✅
- 관리자 대시보드 전용 API
- 모든 마이크로서비스 통합
- 권한 기반 데이터 필터링
- 관리 작업 오케스트레이션

#### **user-api:3092** ⚠️
- 기본 컨트롤러 구현
- NATS 통합 미완료
- Prisma 스키마 없음
- **필수**: NATS 통합 구현

### 개발 우선순위

#### 🔥 높음 (즉시 해결)
1. **user-api** - NATS 통합 구현
2. **user-webapp** - 예약 플로우 구현
3. **결제 시스템** - PG사 연동

#### 📋 중간 (다음 스프린트)
1. **search-service** - 전체 구현
2. **ml-service** - ML 모델 구현
3. **성능 최적화** - 캐싱, 인덱싱

#### 📝 낮음 (향후 계획)
1. **모니터링** - Prometheus + Grafana
2. **로깅** - ELK Stack
3. **보안** - 추가 보안 레이어

---

**이 서비스 맵으로 전체 아키텍처와 작업 우선순위 파악 가능! 🗺️**